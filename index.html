<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªØ³Ø¬ÙŠÙ„ Ø³Ø§Ø¹Ø§ØªÙŠ - Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
padding: 20px;
}

/* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
.login-screen {
max-width: 400px;
margin: 100px auto;
background: white;
border-radius: 20px;
padding: 40px;
box-shadow: 0 20px 60px rgba(0,0,0,0.3);
text-align: center;
}

.login-screen h2 {
color: #2c3e50;
margin-bottom: 30px;
font-size: 2em;
}

.login-screen input {
width: 100%;
padding: 15px;
margin: 10px 0;
border: 2px solid #e0e0e0;
border-radius: 10px;
font-size: 1em;
}

.login-screen button {
width: 100%;
padding: 15px;
background: #667eea;
color: white;
border: none;
border-radius: 10px;
font-size: 1.1em;
font-weight: bold;
cursor: pointer;
margin-top: 20px;
}

.login-screen button:hover {
background: #764ba2;
}

.user-type {
margin: 20px 0;
display: flex;
gap: 10px;
justify-content: center;
}

.user-type label {
display: flex;
align-items: center;
gap: 5px;
cursor: pointer;
}

/* Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¯ÙŠØ± (Admin) */
.admin-screen, .worker-screen {
display: none;
}

.container {
max-width: 1200px;
margin: 0 auto;
background: white;
border-radius: 20px;
box-shadow: 0 20px 60px rgba(0,0,0,0.3);
overflow: hidden;
}

.header {
background: #2c3e50;
color: white;
padding: 20px 30px;
display: flex;
justify-content: space-between;
align-items: center;
}

.header h1 {
font-size: 2em;
}

.logout-btn {
background: #e74c3c;
color: white;
border: none;
padding: 10px 20px;
border-radius: 10px;
cursor: pointer;
font-size: 1em;
}

.main-content {
padding: 30px;
}

/* Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø§Ù…Ù„ */
.worker-simple {
max-width: 600px;
margin: 30px auto;
background: white;
border-radius: 20px;
padding: 30px;
box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}

.worker-simple h2 {
color: #2c3e50;
text-align: center;
margin-bottom: 30px;
font-size: 2em;
}

.current-time {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
padding: 20px;
border-radius: 15px;
text-align: center;
margin-bottom: 30px;
}

.current-time .time-label {
font-size: 1.1em;
opacity: 0.9;
margin-bottom: 5px;
}

.current-time .time-value {
font-size: 2.5em;
font-weight: bold;
font-family: monospace;
direction: ltr;
}

.current-time .date-value {
font-size: 1.2em;
margin-top: 5px;
}

.time-input-group {
background: #f8f9fa;
padding: 20px;
border-radius: 15px;
margin-bottom: 20px;
}

.time-input-group label {
display: block;
margin-bottom: 10px;
color: #2c3e50;
font-weight: bold;
font-size: 1.1em;
}

.time-input-group input {
width: 100%;
padding: 15px;
border: 2px solid #e0e0e0;
border-radius: 10px;
font-size: 1.1em;
font-family: monospace;
direction: ltr;
}

.time-input-group input:focus {
outline: none;
border-color: #667eea;
box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.time-display {
background: #e8f5e9;
padding: 20px;
border-radius: 15px;
margin: 20px 0;
text-align: center;
}

.time-display .label {
color: #2e7d32;
font-size: 1.1em;
margin-bottom: 5px;
}

.time-display .value {
color: #1b5e20;
font-size: 2em;
font-weight: bold;
}

.warning-message {
background: #fff3e0;
color: #e65100;
padding: 15px;
border-radius: 10px;
margin: 15px 0;
text-align: center;
font-weight: bold;
}

.worker-simple input, .worker-simple textarea {
width: 100%;
padding: 12px;
margin: 10px 0;
border: 2px solid #e0e0e0;
border-radius: 10px;
font-size: 1em;
}

.worker-simple button {
width: 100%;
padding: 15px;
background: #27ae60;
color: white;
border: none;
border-radius: 10px;
font-size: 1.1em;
font-weight: bold;
cursor: pointer;
margin-top: 20px;
transition: all 0.3s;
}

.worker-simple button:hover {
background: #219a52;
transform: translateY(-2px);
box-shadow: 0 10px 30px rgba(39, 174, 96, 0.3);
}

.success-message {
background: #27ae60;
color: white;
padding: 15px;
border-radius: 10px;
text-align: center;
margin: 10px 0;
display: none;
font-weight: bold;
}

/* Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ù„Ù„Ù…Ø¯ÙŠØ± */
.stats-container {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 20px;
margin-bottom: 30px;
}

.stat-card {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
padding: 20px;
border-radius: 15px;
text-align: center;
}

.filters {
display: flex;
gap: 15px;
margin-bottom: 20px;
flex-wrap: wrap;
align-items: center;
}

.search-box, .filter-select {
padding: 12px;
border: 2px solid #e0e0e0;
border-radius: 10px;
font-size: 1em;
flex: 1;
min-width: 200px;
}

.action-buttons-group {
display: flex;
gap: 10px;
margin-right: auto;
}

.action-btn {
padding: 12px 20px;
border: none;
border-radius: 10px;
cursor: pointer;
font-size: 0.95em;
font-weight: 600;
transition: all 0.3s;
}

.export-btn {
background: #27ae60;
color: white;
}
.export-btn:hover { background: #219a52; }

.delete-all-btn {
background: #e74c3c;
color: white;
}
.delete-all-btn:hover { background: #c0392b; }

.table-container {
overflow-x: auto;
background: white;
border-radius: 15px;
box-shadow: 0 5px 20px rgba(0,0,0,0.1);
margin-top: 20px;
}

table {
width: 100%;
border-collapse: collapse;
}

th {
background: #2c3e50;
color: white;
padding: 15px;
font-size: 0.95em;
}

td {
padding: 15px;
text-align: center;
border-bottom: 1px solid #ecf0f1;
}

tr:hover {
background: #f8f9fa;
}

.delete-record-btn {
background: #e74c3c;
color: white;
border: none;
padding: 5px 15px;
border-radius: 5px;
cursor: pointer;
font-size: 0.9em;
}

.delete-record-btn:hover {
background: #c0392b;
}

/* Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ù…Ø®ØµØµØ© */
.confirm-dialog {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: rgba(0,0,0,0.5);
display: flex;
justify-content: center;
align-items: center;
z-index: 1000;
display: none;
}

.confirm-content {
background: white;
padding: 30px;
border-radius: 15px;
max-width: 400px;
text-align: center;
}

.confirm-content h3 {
color: #2c3e50;
margin-bottom: 15px;
}

.confirm-content p {
color: #7f8c8d;
margin-bottom: 25px;
}

.confirm-buttons {
display: flex;
gap: 10px;
justify-content: center;
}

.confirm-btn {
padding: 10px 30px;
border: none;
border-radius: 8px;
cursor: pointer;
font-size: 1em;
}

.confirm-yes {
background: #e74c3c;
color: white;
}

.confirm-no {
background: #95a5a6;
color: white;
}

.time-details {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 15px;
margin: 20px 0;
}

.time-box {
background: #f8f9fa;
padding: 15px;
border-radius: 10px;
text-align: center;
}

.time-box .title {
color: #7f8c8d;
font-size: 0.9em;
margin-bottom: 5px;
}

.time-box .time {
color: #2c3e50;
font-size: 1.3em;
font-weight: bold;
font-family: monospace;
direction: ltr;
}
</style>
</head>
<body>
<!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginScreen" class="login-screen">
<h2>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
<div class="user-type">
<label>
<input type="radio" name="userType" value="admin" checked> Ù…Ø¯ÙŠØ±
</label>
<label>
<input type="radio" name="userType" value="worker"> Ø¹Ø§Ù…Ù„
</label>
</div>
<input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
<input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¯ÙŠØ± (Admin) -->
<div id="adminScreen" class="admin-screen">
<div class="container">
<div class="header">
<h1>ğŸ‘‘ ØªØ³Ø¬ÙŠÙ„ Ø³Ø§Ø¹Ø§ØªÙŠ - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
<button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<div class="main-content">
<!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
<div class="stats-container">
<div class="stat-card">
<h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ø§Ù„</h3>
<div class="number" id="totalWorkers">0</div>
</div>
<div class="stat-card">
<h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</h3>
<div class="number" id="totalHours">0</div>
</div>
<div class="stat-card">
<h3>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø§Ø¹Ø§Øª</h3>
<div class="number" id="avgHours">0</div>
</div>
<div class="stat-card">
<h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</h3>
<div class="number" id="totalRecords">0</div>
</div>
</div>

<!-- Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© ÙˆØ£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
<div class="filters">
<input type="text" id="searchInput" class="search-box" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ Ø£Ùˆ Ø§Ù„Ù…Ù‡Ù…Ø©...">
<select id="workerFilter" class="filter-select">
<option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ø§Ù„</option>
</select>
<div class="action-buttons-group">
<button class="action-btn export-btn" onclick="exportToExcel()">
ğŸ“¥ ØªØµØ¯ÙŠØ± Excel
</button>
<button class="action-btn delete-all-btn" onclick="showDeleteAllConfirm()">
ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙƒÙ„
</button>
</div>
</div>

<!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
<div class="table-container">
<table id="workTable">
<thead>
<tr>
<th>#</th>
<th>Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„</th>
<th>Ø§Ù„Ù…Ù‡Ù…Ø©</th>
<th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
<th>ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</th>
<th>ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</th>
<th>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</th>
<th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
<th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="tableBody">
</tbody>
</table>
</div>

<!-- Ù…Ù„Ø®Øµ Ø£Ø³ÙÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
<div style="margin-top: 20px; color: #7f8c8d; text-align: left;">
<small>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©: <span id="displayedRecords">0</span></small>
</div>
</div>
</div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø§Ù…Ù„ (Ø¨Ø³ÙŠØ·Ø©) -->
<div id="workerScreen" class="worker-screen">
<div class="worker-simple">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
<h2>â° ØªØ³Ø¬ÙŠÙ„ Ø³Ø§Ø¹Ø§ØªÙŠ</h2>
<button class="logout-btn" onclick="logout()" style="width: auto; padding: 8px 15px;">Ø®Ø±ÙˆØ¬</button>
</div>

<div id="successMessage" class="success-message">
âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø¨Ù†Ø¬Ø§Ø­
</div>

<!-- Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø«Ø§Ø¨Øª Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡) -->
<div class="current-time">
<div class="time-label">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ (ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©)</div>
<div class="time-value" id="currentTimeDisplay">--:--:--</div>
<div class="date-value" id="currentDateDisplay"></div>
</div>

<form id="workerForm" onsubmit="return false;">
<input type="text" id="workerName" placeholder="Ø§Ù„Ø§Ø³Ù…" required>
<input type="text" id="workerJob" placeholder="Ø§Ù„Ù…Ù‡Ù…Ø©" required>

<!-- ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙÙ‚Ø· (ÙŠÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ ÙˆÙ‚Øª Ù…Ù† Ø§Ù„Ù…Ø§Ø¶ÙŠ) -->
<div class="time-input-group">
<label>â±ï¸ ÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ù…Ù„</label>
<input type="time" id="startTime" required>
</div>

<!-- Ø¹Ø±Ø¶ ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© -->
<div class="time-details">
<div class="time-box">
<div class="title">ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</div>
<div class="time" id="displayStartTime">--:--</div>
</div>
<div class="time-box">
<div class="title">ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Ø§Ù„Ø¢Ù†)</div>
<div class="time" id="displayEndTime">--:--</div>
</div>
</div>

<!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø­Ø³ÙˆØ¨ (Ø¨Ø¯ÙˆÙ† Ø­Ø¯ Ø£Ù‚ØµÙ‰) -->
<div class="time-display">
<div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</div>
<div class="value" id="totalHoursDisplay">0 Ø³Ø§Ø¹Ø©</div>
</div>

<!-- ØªØ­Ø°ÙŠØ± Ø¥Ø°Ø§ ÙƒØ§Ù† ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù…Ø³ØªØ­ÙŠÙ„) -->
<div id="timeWarning" class="warning-message" style="display: none;">
âš ï¸ ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
</div>

<textarea id="notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" rows="3"></textarea>

<button type="button" id="submitBtn" onclick="submitWorkerHours()">âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</button>
</form>

<div style="margin-top: 20px; text-align: center; color: #7f8c8d; font-size: 0.9em;">
<p>â° ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
</div>
</div>
</div>

<!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„ÙƒÙ„ -->
<div id="confirmDialog" class="confirm-dialog">
<div class="confirm-content">
<h3>ğŸ—‘ï¸ ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</h3>
<p>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ØŸ</p>
<p style="color: #e74c3c; font-weight: bold;">Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!</p>
<div class="confirm-buttons">
<button class="confirm-btn confirm-yes" onclick="deleteAllRecords()">Ù†Ø¹Ù…ØŒ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
<button class="confirm-btn confirm-no" onclick="hideDeleteAllConfirm()">Ø¥Ù„ØºØ§Ø¡</button>
</div>
</div>
</div>

<script>
// ==================== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ====================
const ADMIN_USERNAME = "admin";
const ADMIN_PASSWORD = "admin123";

// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„ (Ù…Ø´ØªØ±ÙƒØ©)
let workRecords = JSON.parse(localStorage.getItem('workRecords')) || [];

// Ù…ØªØºÙŠØ± Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
let timeUpdateInterval;

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
function login() {
const userType = document.querySelector('input[name="userType"]:checked').value;
const username = document.getElementById('username').value;
const password = document.getElementById('password').value;

if (userType === 'admin') {
if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
// Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±
document.getElementById('loginScreen').style.display = 'none';
document.getElementById('adminScreen').style.display = 'block';
document.getElementById('workerScreen').style.display = 'none';
displayAdminRecords();
updateAdminStats();

// Ø¥ÙŠÙ‚Ø§Ù ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ø´ØºØ§Ù„
if (timeUpdateInterval) {
clearInterval(timeUpdateInterval);
}
} else {
alert('âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
}
} else {
// Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù…Ù„ - Ø£ÙŠ Ø§Ø³Ù… ÙˆÙƒÙ„Ù…Ø© Ø³Ø±
if (username && password) {
document.getElementById('loginScreen').style.display = 'none';
document.getElementById('adminScreen').style.display = 'none';
document.getElementById('workerScreen').style.display = 'block';

// ØªØ¹Ø¨Ø¦Ø© Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ Ø¥Ø°Ø§ ÙƒØªØ¨Ù‡ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
if (username) {
document.getElementById('workerName').value = username;
}

// Ø¨Ø¯Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
startTimeUpdates();

// ØªØ¹ÙŠÙŠÙ† ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø¢Ø®Ø± Ø³Ø§Ø¹Ø©)
setDefaultStartTime();
} else {
alert('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
}
}
}

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
function logout() {
document.getElementById('loginScreen').style.display = 'block';
document.getElementById('adminScreen').style.display = 'none';
document.getElementById('workerScreen').style.display = 'none';
document.getElementById('username').value = '';
document.getElementById('password').value = '';
// Ø¥Ø®ÙØ§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©
hideDeleteAllConfirm();

// Ø¥ÙŠÙ‚Ø§Ù ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
if (timeUpdateInterval) {
clearInterval(timeUpdateInterval);
}
}

// ==================== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙˆÙ‚Øª Ù„Ù„Ø¹Ø§Ù…Ù„ ====================
function startTimeUpdates() {
// ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
timeUpdateInterval = setInterval(updateCurrentTime, 1000);
updateCurrentTime(); // ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ
}

function updateCurrentTime() {
const now = new Date();

// ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª
const timeString = now.toLocaleTimeString('ar-EG', {
hour: '2-digit',
minute: '2-digit',
second: '2-digit',
hour12: true
});

// ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
const dateString = now.toLocaleDateString('ar-EG', {
weekday: 'long',
year: 'numeric',
month: 'long',
day: 'numeric'
});

document.getElementById('currentTimeDisplay').textContent = timeString;
document.getElementById('currentDateDisplay').textContent = dateString;

// ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶
document.getElementById('displayEndTime').textContent = timeString;
// Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù† ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù…Ø­Ø¯Ø¯
calculateHours();
}

function setDefaultStartTime() {
const now = new Date();
// Ù†Ø·Ø±Ø­ Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø© ÙƒÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠ
now.setHours(now.getHours() - 1);

const hours = now.getHours().toString().padStart(2, '0');
const minutes = now.getMinutes().toString().padStart(2, '0');
const defaultTime = `${hours}:${minutes}`;

document.getElementById('startTime').value = defaultTime;
document.getElementById('displayStartTime').textContent = defaultTime;

calculateHours();
}

function calculateHours() {
const startTimeInput = document.getElementById('startTime').value;

if (!startTimeInput) {
document.getElementById('totalHoursDisplay').textContent = '0 Ø³Ø§Ø¹Ø©';
return;
}

const now = new Date();
const [startHours, startMinutes] = startTimeInput.split(':').map(Number);

const startDate = new Date(now);
startDate.setHours(startHours, startMinutes, 0, 0);

// Ø§Ù„ØªØ­Ù‚Ù‚: ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
if (startDate > now) {
document.getElementById('timeWarning').style.display = 'block';
document.getElementById('submitBtn').disabled = true;
document.getElementById('totalHoursDisplay').textContent = 'âš ï¸ ÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­';
return;
}

document.getElementById('timeWarning').style.display = 'none';
document.getElementById('submitBtn').disabled = false;

// Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±Ù‚ Ø¨Ø§Ù„Ø³Ø§Ø¹Ø§Øª (Ø¨Ø¯ÙˆÙ† Ø­Ø¯ Ø£Ù‚ØµÙ‰)
const diffMs = now - startDate;
const diffHours = diffMs / (1000 * 60 * 60);
const roundedHours = Math.round(diffHours * 10) / 10; // ØªÙ‚Ø±ÙŠØ¨ Ù„Ø±Ù‚Ù… Ø¹Ø´Ø±ÙŠ ÙˆØ§Ø­Ø¯

document.getElementById('totalHoursDisplay').textContent = `${roundedHours} Ø³Ø§Ø¹Ø©`;

// ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶
document.getElementById('displayStartTime').textContent = startTimeInput;
}

// ==================== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ø§Ù…Ù„ ====================
function submitWorkerHours() {
const workerName = document.getElementById('workerName').value.trim();
const workerJob = document.getElementById('workerJob').value.trim();
const startTime = document.getElementById('startTime').value;
const notes = document.getElementById('notes').value.trim();

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
if (!workerName || !workerJob || !startTime) {
alert('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
return;
}

const now = new Date();
const [startHours, startMinutes] = startTime.split(':').map(Number);
const startDate = new Date(now);
startDate.setHours(startHours, startMinutes, 0, 0);

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ø±Ø© Ø£Ø®ÙŠØ±Ø©
if (startDate > now) {
alert('âŒ ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ');
return;
}

// Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª (Ø¨Ø¯ÙˆÙ† Ø­Ø¯ Ø£Ù‚ØµÙ‰)
const diffMs = now - startDate;
const hoursWorked = Math.round((diffMs / (1000 * 60 * 60)) * 10) / 10;

// Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯
const newRecord = {
id: Date.now(),
workerName: workerName,
job: workerJob,
date: now.toISOString().split('T')[0],
startTime: startTime,
endTime: now.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' }),
hours: hoursWorked,
notes: notes,
timestamp: now.toISOString()
};

// Ø­ÙØ¸ ÙÙŠ localStorage
workRecords.push(newRecord);
localStorage.setItem('workRecords', JSON.stringify(workRecords));

// Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
const successMsg = document.getElementById('successMessage');
successMsg.style.display = 'block';
successMsg.textContent = `âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${hoursWorked} Ø³Ø§Ø¹Ø© Ø¨Ù†Ø¬Ø§Ø­`;

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ø¹ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø§Ø³Ù…
const currentName = workerName;
document.getElementById('workerForm').reset();
document.getElementById('workerName').value = currentName;

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
setDefaultStartTime();

// Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†
setTimeout(() => {
successMsg.style.display = 'none';
}, 3000);
}

// ==================== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø¯ÙŠØ± ====================
function displayAdminRecords() {
const searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
const workerFilter = document.getElementById('workerFilter')?.value || 'all';

let filteredRecords = [...workRecords];

// ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø­Ø«
if (searchTerm) {
filteredRecords = filteredRecords.filter(record =>
record.workerName.toLowerCase().includes(searchTerm) ||
record.job.toLowerCase().includes(searchTerm)
);
}

// ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ø¹Ø§Ù…Ù„
if (workerFilter !== 'all') {
filteredRecords = filteredRecords.filter(record => record.workerName === workerFilter);
}

// ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
filteredRecords.sort((a, b) => new Date(b.date) - new Date(a.date));

const tbody = document.getElementById('tableBody');
if (!tbody) return;

tbody.innerHTML = '';

if (filteredRecords.length === 0) {
tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 50px; color: #7f8c8d;">ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§</td></tr>';
} else {
filteredRecords.forEach((record, index) => {
const row = tbody.insertRow();
row.innerHTML = `
<td>${index + 1}</td>
<td><strong>${record.workerName}</strong></td>
<td>${record.job}</td>
<td>${new Date(record.date).toLocaleDateString('ar-SA')}</td>
<td>${record.startTime || '--:--'}</td>
<td>${record.endTime || '--:--'}</td>
<td>${record.hours} Ø³Ø§Ø¹Ø©</td>
<td>${record.notes || '-'}</td>
<td>
<button class="delete-record-btn" onclick="adminDeleteRecord(${record.id})">
ğŸ—‘ï¸ Ø­Ø°Ù
</button>
</td>
`;
});
}

// ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
document.getElementById('displayedRecords').textContent = filteredRecords.length;

updateWorkerFilter();
updateAdminStats();
}

// Ø­Ø°Ù Ø³Ø¬Ù„ ÙØ±Ø¯ÙŠ (Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·)
function adminDeleteRecord(id) {
if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ')) {
workRecords = workRecords.filter(r => r.id !== id);
localStorage.setItem('workRecords', JSON.stringify(workRecords));
displayAdminRecords();
}
}

// Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„ÙƒÙ„
function showDeleteAllConfirm() {
if (workRecords.length === 0) {
alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­Ø°Ù');
return;
}
document.getElementById('confirmDialog').style.display = 'flex';
}

// Ø¥Ø®ÙØ§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯
function hideDeleteAllConfirm() {
document.getElementById('confirmDialog').style.display = 'none';
}

// Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
function deleteAllRecords() {
workRecords = [];
localStorage.setItem('workRecords', JSON.stringify(workRecords));
hideDeleteAllConfirm();
displayAdminRecords();

// Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù
setTimeout(() => {
alert('âœ… ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
}, 100);
}

// ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ±
function updateAdminStats() {
const totalWorkers = [...new Set(workRecords.map(record => record.workerName))].length;
const totalHours = workRecords.reduce((sum, record) => sum + record.hours, 0);
const avgHours = workRecords.length > 0 ? (totalHours / workRecords.length).toFixed(1) : 0;

document.getElementById('totalWorkers').textContent = totalWorkers;
document.getElementById('totalHours').textContent = totalHours.toFixed(1);
document.getElementById('avgHours').textContent = avgHours;
document.getElementById('totalRecords').textContent = workRecords.length;
}

// ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ø§Ù„ ÙÙŠ Ø§Ù„ÙÙ„ØªØ±
function updateWorkerFilter() {
const workers = [...new Set(workRecords.map(record => record.workerName))];
const filterSelect = document.getElementById('workerFilter');
if (!filterSelect) return;

const currentValue = filterSelect.value;
filterSelect.innerHTML = '<option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ø§Ù„</option>';

workers.sort().forEach(worker => {
const option = document.createElement('option');
option.value = worker;
option.textContent = worker;
filterSelect.appendChild(option);
});

if (currentValue && workers.includes(currentValue)) {
filterSelect.value = currentValue;
}
}

// ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel (Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·)
function exportToExcel() {
if (workRecords.length === 0) {
alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
return;
}

// ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
const headers = ['Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„Ù…Ù‡Ù…Ø©', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©', 'ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©', 'Ø§Ù„Ø³Ø§Ø¹Ø§Øª', 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª', 'ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„'];
const data = workRecords.map(record => [
record.workerName,
record.job,
new Date(record.date).toLocaleDateString('ar-SA'),
record.startTime || '',
record.endTime || '',
record.hours,
record.notes || '',
record.timestamp ? new Date(record.timestamp).toLocaleString('ar-SA') : '-'
]);

// Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ CSV
let csvContent = headers.join(',') + '\n' +
data.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');

// Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
const link = document.createElement('a');
link.href = URL.createObjectURL(blob);

// ØªÙ†Ø³ÙŠÙ‚ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù
const now = new Date();
const fileName = `ØªÙ‚Ø±ÙŠØ±_Ø³Ø§Ø¹Ø§Øª_Ø§Ù„Ø¹Ù…Ù„_${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}.csv`;
link.download = fileName;

link.click();

// Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯
alert(`âœ… ØªÙ… ØªØµØ¯ÙŠØ± ${workRecords.length} Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­`);
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ù…Ø¯ÙŠØ±
function setupEventListeners() {
if (document.getElementById('searchInput')) {
document.getElementById('searchInput').addEventListener('input', displayAdminRecords);
}
if (document.getElementById('workerFilter')) {
document.getElementById('workerFilter').addEventListener('change', displayAdminRecords);
}

// Ù…Ø³ØªÙ…Ø¹ Ù„ØªØºÙŠÙŠØ± ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
document.getElementById('startTime')?.addEventListener('change', calculateHours);
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
window.onload = function() {
// Ù†Ø¨Ø¯Ø£ Ø¨Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
document.getElementById('loginScreen').style.display = 'block';
document.getElementById('adminScreen').style.display = 'none';
document.getElementById('workerScreen').style.display = 'none';

// ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
setupEventListeners();
// Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¥Ø°Ø§ Ù†Ù‚Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø®Ø§Ø±Ø¬Ù‡Ø§
window.onclick = function(event) {
const dialog = document.getElementById('confirmDialog');
if (event.target === dialog) {
hideDeleteAllConfirm();
}
};
}
</script>
</body>
</html>
